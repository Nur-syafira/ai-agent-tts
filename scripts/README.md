# Scripts - Testing & Utilities

–£—Ç–∏–ª–∏—Ç—ã –∏ —Ç–µ—Å—Ç—ã –¥–ª—è Sales Agent MVP.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π

### `check_models.py` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –ª–∏ –º–æ–¥–µ–ª–∏ —Å–∫–∞—á–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ:

```bash
./venv/bin/python scripts/check_models.py
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ CUDA
- ‚úÖ faster-whisper large-v3-turbo
- ‚úÖ Silero VAD
- ‚úÖ Kokoro-82M
- ‚úÖ Piper TTS
- ‚úÖ Qwen2.5-14B-Instruct-AWQ (–≤ –∫—ç—à–µ)

**–í—ã–≤–æ–¥:**
```
‚úÖ All critical components ready!
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞

### `test_dialog_simulator.py` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∏–º—É–ª—è—Ç–æ—Ä –¥–∏–∞–ª–æ–≥–∞

–°–∏–º—É–ª–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –¥–∏–∞–ª–æ–≥ –º–µ–∂–¥—É AI-–∞–≥–µ–Ω—Ç–æ–º –∏ –ø–∞—Ü–∏–µ–Ω—Ç–æ–º.

**–ó–∞–ø—É—Å–∫:**

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d redis
vllm serve Qwen/Qwen2.5-14B-Instruct-AWQ ...  # –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
./venv/bin/python src/policy_engine/main.py    # –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
./venv/bin/python src/tts_gateway/main.py      # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

# 2. –ó–∞–ø—É—Å—Ç–∏ —Å–∏–º—É–ª—è—Ç–æ—Ä
./venv/bin/python scripts/test_dialog_simulator.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ 20+ turns –¥–∏–∞–ª–æ–≥–∞
- –°–∏–º—É–ª–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –∞–≥–µ–Ω—Ç–∞
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
================================================================================
Turn 1
================================================================================
üë§ –ü–∞—Ü–∏–µ–Ω—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ú–†–¢ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–æ–∑–≥–∞
ü§ñ –ê–≥–µ–Ω—Ç: –î–æ–±—Ä—ã–π –¥–µ–Ω—å! –ú–µ–Ω—è –∑–æ–≤—É—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞ –ú–†–¢ 1.5–¢. –ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?
üìä State: ask_client_name
üìù –ó–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–ª–æ—Ç–æ–≤: 1
   - study_type: –ú–†–¢ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–æ–∑–≥–∞
```

---

### `test_voice_chat.py` - –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)

–ü–æ–∑–≤–æ–ª—è–µ—Ç **—Ä–µ–∞–ª—å–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å AI-–∞–≥–µ–Ω—Ç–æ–º** —á–µ—Ä–µ–∑ –º–∏–∫—Ä–æ—Ñ–æ–Ω.

**–ó–∞–ø—É—Å–∫:**

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏ –í–°–ï —Å–µ—Ä–≤–∏—Å—ã (–≤–∫–ª—é—á–∞—è ASR –∏ TTS)
docker-compose up -d redis jaeger
vllm serve Qwen/Qwen2.5-14B-Instruct-AWQ ...
./venv/bin/python src/asr_gateway/main.py
./venv/bin/python src/tts_gateway/main.py
./venv/bin/python src/policy_engine/main.py

# 2. –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç
./venv/bin/python scripts/test_voice_chat.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–≤–æ—é —Ä–µ—á—å —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ (5 —Å–µ–∫)
- –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —á–µ—Ä–µ–∑ ASR (–ø–æ–∫–∞ mock - –≤–≤–æ–¥–∏—à—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Policy Engine
- –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞
- –°–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç —Ä–µ—á—å —á–µ—Ä–µ–∑ TTS (Kokoro –∏–ª–∏ Piper)
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏–∫–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** ASR WebSocket –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Ç–µ—Å—Ç–µ, –ø–æ—ç—Ç–æ–º—É –≤–º–µ—Å—Ç–æ –∑–∞–ø–∏—Å–∏ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –Ω—É–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é. –ù–æ TTS —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é - –∞–≥–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏—Ç –≥–æ–ª–æ—Å–æ–º!

---

## üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã

### `setup_env.sh` - –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç GPU persistence –∏ CPU performance mode:

```bash
sudo ./scripts/setup_env.sh
```

### `download_models.py` - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

–°–∫–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥–µ–ª–∏:

```bash
./venv/bin/python scripts/download_models.py
```

–°–∫–∞—á–∏–≤–∞–µ—Ç:
- faster-whisper large-v3-turbo
- Qwen2.5-14B-Instruct-AWQ
- Piper TTS –º–æ–¥–µ–ª—å (ru_RU-dmitri-medium)
- Silero VAD

### `health_check.py` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —Å–∏—Å—Ç–µ–º—É:

```bash
./venv/bin/python scripts/health_check.py
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Python, CUDA, credentials)
- GPU —Å—Ç–∞—Ç—É—Å (VRAM, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –∑–∞–≥—Ä—É–∑–∫–∞)
- System stats (CPU, RAM)
- Redis —Å—Ç–∞—Ç—É—Å
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (ASR, LLM, TTS, Policy)

---

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∏–º—É–ª—è—Ü–∏—è (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

```bash
# –ú–∏–Ω–∏–º—É–º —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d redis
vllm serve Qwen/Qwen2.5-14B-Instruct-AWQ --host 0.0.0.0 --port 8000 --max-model-len 2048 --gpu-memory-utilization 0.75 --quantization awq &
./venv/bin/python src/policy_engine/main.py &

# –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞
./venv/bin/python scripts/test_dialog_simulator.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d redis
vllm serve Qwen/Qwen2.5-14B-Instruct-AWQ ... &
./venv/bin/python src/asr_gateway/main.py &
./venv/bin/python src/tts_gateway/main.py &
./venv/bin/python src/policy_engine/main.py &

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
./venv/bin/python scripts/test_voice_chat.py
```

---

## üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π** - —É–±–µ–¥–∏—Å—å —á—Ç–æ –≤—Å—ë —Å–∫–∞—á–∞–Ω–æ
2. **–°–∏–º—É–ª—è—Ç–æ—Ä** - –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –¥–∏–∞–ª–æ–≥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å–µ 30 —ç—Ç–∞–ø–æ–≤
3. **Health check** - —É–±–µ–¥–∏—Å—å —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã healthy
4. **Voice chat** - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π TTS (–∞–≥–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç)
5. **Google Sheets** - –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –õ–∏—Å—Ç4

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |
|---------|------|---------------|
| ASR latency | 80-150 –º—Å | `scripts/health_check.py` |
| LLM latency | 40-150 –º—Å | Jaeger UI (localhost:16686) |
| TTS latency | 50-120 –º—Å | –ò–∑–º–µ—Ä–∏—Ç—å –≤ `test_voice_chat.py` |
| E2E dialog turn | 250-600 –º—Å | –°–∏–º—É–ª—è—Ç–æ—Ä |
| Dialog completion | 100% | –°–∏–º—É–ª—è—Ç–æ—Ä –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ |
| Slots filled | 10+ | –°–∏–º—É–ª—è—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–æ—Ç—ã |

---

## üêõ Troubleshooting

### –°–∏–º—É–ª—è—Ç–æ—Ä: "Policy Engine –Ω–µ –∑–∞–ø—É—â–µ–Ω"

```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ Policy Engine –∑–∞–ø—É—â–µ–Ω
curl http://localhost:8003/health

# –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–ø—É—Å—Ç–∏
./venv/bin/python src/policy_engine/main.py
```

### Voice chat: "TTS Gateway error"

```bash
# –ü—Ä–æ–≤–µ—Ä—å TTS Gateway
curl http://localhost:8002/health

# –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–ø—É—Å—Ç–∏
./venv/bin/python src/tts_gateway/main.py
```

### –ú–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

```bash
# –°–∫–∞—á–∞–π –º–æ–¥–µ–ª–∏
./venv/bin/python scripts/download_models.py

# –ü—Ä–æ–≤–µ—Ä—å
./venv/bin/python scripts/check_models.py
```

---

**–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üöÄ

